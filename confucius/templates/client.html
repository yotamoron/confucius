<!doctype html>

<?xml version="1.0" encoding="UTF-8"?>
<html xmlns='http://www.w3.org/1999/xhtml' xmlns:v="urn:schemas-microsoft-com:vml">
<head>
    <link rel="shortcut icon" href="{{ url_for('.static', filename='favicon.ico') }}" />
	<link rel="stylesheet" href="http://jsplumbtoolkit.com//demo-all.css">
	<link rel="stylesheet" href="http://jsplumbtoolkit.com/home/demo.css">
	<link rel="stylesheet" href="../static/css/jquery.contextMenu.css">
</head>

<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js'></script>
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js'></script>
<script type='text/javascript' src='http://jsplumbtoolkit.com/lib/jquery.ui.touch-punch.min.js'></script>
<script type='text/javascript' src='http://jsplumbtoolkit.com/js/jquery.jsPlumb-1.5.2-min.js'></script>

<script type='text/javascript' src='../static/js/jquery.contextMenu.js'></script>
<script type='text/javascript' src='../static/js/model_serializer.js'></script>
<script type='text/javascript' src='../static/js/addSource.js'></script>
<script type='text/javascript' src='../static/js/addElement.js'></script>
<script type='text/javascript' src='../static/js/plumb.js'></script>
<script type='text/javascript' src='../static/js/client.js'></script>
<script type='text/javascript' src='../static/js/fields.js'></script>
<script type='text/javascript' src='../static/js/dialogs.js'></script>


<script>
	jsPlumb.bind("ready", function() {        
		configurePlumba();
	});

	$(document).ready(function() {
		$("#btnAddSource").click(function(){
		
			var counterId = Math.floor((Math.random()*100000000)+1);
			var divId = "window" + counterId;			
			addSource(divId, "Source");
			configurePlumbSource(divId);
		});
		
		$("#btnAddElement").click(function(){
			var counterId = Math.floor((Math.random()*100000000)+1);
			var divId = "window" + counterId;
			addElement(divId, $("#transformerType").val(),  $("#transformerType").val());
			configurePlumbElement(divId, BOTH_ANCHORS);
        });
        $.contextMenu({
            selector: '.component', 
            callback: function(key, options) {
                var myId = $(this).attr('id')
                var jObj = $('#' + myId)
                if (key == "edit") {
                    /* XXX: we should have a per-type callback here for editing */
                    $('#title').val(jObj.text());
                    $('#element-id').val(myId);
                    $('#service-form').dialog('open');
                } else {
                    deleteEndPoint(myId);
                }
            },
            items: {
                "edit": {name: "Edit", icon: "edit"},
                "delete": {name: "Delete", icon: "delete"},
            }
        });
        prepareSourcePopupForm();
	});

</script>
	<body>
		<br>
		<button type="button" id="btnAddSource">Add Stream Source</button>
		<button type="button" id="btnAddElement">Add element</button>
		<select id="transformerType">
		  <option value="where">Where?</option>
		  <option value="rollup">Rollup</option>
		  <option value="rate">Rate</option>
		  <option value="email">Email</option>
		</select>
		<div align="right"><button type="button" id="btnSave">Save changes</button><div>
        <div id="main">
			<div id="render"></div>	

        </div>
        <div id="service-form" title="Edit Source Parameters">
         
          <form>
              <fieldset>
                <label for="title">Title</label>
                <input type="text" name="title" id="title" class="text ui-widget-content ui-corner-all" />
                <input type="hidden" name="element-id" id="element-id" value="" />
              </fieldset>
          </form>
        </div>
    </body>
        
</html>
